---
language: ruby
sudo: false
cache: bundler
before_install:
  - gem update bundler
jobs:
  include:
    - &test
      stage: test
      rvm: 2.4.9
      script:
        - bundle exec rubocop
        - bundle exec rake spec
      if: tag IS blank
    - <<: *test
      rvm: 2.5.7
    - <<: *test
      rvm: 2.6.5
    - stage: deploy
      rvm: 2.4.9
      script:
        - npm run build
      deploy:
        provider: rubygems
        skip_cleanup: true
        api_key: $RUBYGEMS_API_KEY
        on:
          tags: true
          branch: master
      if: tag IS present
